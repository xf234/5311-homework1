<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Horizontal Calendar</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <!-- <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script src="https://d3js.org/topojson.v3.min.js"></script> -->
  <style>


    rect {
      stroke: #fff;
      rx: 5px;
      ry: 5px;
    }

    #calendar1,
    #calendar2,
    #calendar3,
    #calendar4,
    #calendar5 {
      stroke: #fff;
      stroke-width: 2px;
    }

    text {
      font-family: Arial, sans-serif;
      font-size: 12px;
    }

    #wrap3,
    #wrap4,
    #wrap5 {
      display: none;
    }
  </style>
</head>

<body>



  <div style="display: flex;">

    <div>
      <h4 style="margin-bottom: 45px;">Passengers of all the airports</h4>
      <svg id="calendar1" width="400" height="480"></svg>
    </div>

    <div>
      <div>
        <select id="calendarSelector" style="margin-left: 250px; margin-top: 30px;">
          <option value="wrap2">Hartsfield-Jackson Atlanta International Airport (ATL)</option>
          <option value="wrap3">Chicago O'Hare International Airport(ORD)</option>
          <option value="wrap4">Orlando International Airport (MCO)</option>
          <option value="wrap5">John F. Kennedy International Airport(JFK)</option>
        </select>
      </div>

      <div id="cityCalendar" style="margin-left: 200px;">



        <div id="wrap2" style="margin: 40px;">
          <svg id="calendar2" width="400" height="480"></svg>
        </div>

        <div id="wrap3" style="margin: 40px;">
          <svg id="calendar3" width="400" height="480"></svg>
        </div>

        <div id="wrap4" style="margin: 40px;">
          <svg id="calendar4" width="400" height="480"></svg>
        </div>
        <div id="wrap5" style="margin: 40px;">
          <svg id="calendar5" width="400" height="480"></svg>
        </div>


      </div>


    </div>
  </div>

  <a href="index.htm">go back</a>
  <script>
  
    const requestData = async function () {
      const sum_psgr = await d3.json("data/sum_psgr_all.json", d3.autoType);
      console.log(sum_psgr);
      const atl_psgr = await d3.json("data/most_psgr_atl.json", d3.autoType);
      console.log(atl_psgr);
      const most_flight = await d3.json("data/most_flights_ord.json", d3.autoType);
      console.log(most_flight);
      const mco_psgr = await d3.json("data/travel_psgr_mco.json", d3.autoType);
      console.log(mco_psgr);
      const jfk_psgr = await d3.json("data/normal_psgr_jfk.json", d3.autoType);
      console.log(jfk_psgr);
  
  
  
      display_calendar(sum_psgr, "red", "svg#calendar1", 5, 7, 2006, 2009, "your thoughts");
      display_calendar(atl_psgr, "#FF9234", "svg#calendar2", 5, 7, 2006, 2009, "your thoughts");
      display_calendar(most_flight, "green", "svg#calendar3", 5, 7, 2006, 2009, "your thoughts");
      display_calendar(mco_psgr, "#22C7A9", "svg#calendar4", 5, 7, 2006, 2009, "your thoughts");
      display_calendar(jfk_psgr, "purple", "svg#calendar5", 5, 7, 2006, 2009, "your thoughts");
    }
  
    requestData();
  
  
    function display_calendar(data, color, cldr, month_start, month_end, year_start, year_end, thoughts) {
      const svgCalendar = d3.select(cldr);
  
      const width = svgCalendar.attr("width");
      const height = svgCalendar.attr("height");
      const margin = { top: 15, right: 20, bottom: 20, left: 20 };
      const innerWidth = width - margin.left - margin.right;
      const innerHeight = height - margin.top - margin.bottom;
  
  
      const years_cldr = data.map(d => d.year);
      console.log(years_cldr);
  
      const months = d3.range(12);
  
      const yearScale = d3.scaleBand()
        .domain(years_cldr)
        .range([margin.left, innerWidth]);
  
      const monthScale = d3.scaleBand()
        .domain(months)
        .range([margin.top, innerHeight]);
  
  
      const psgr_mon_Extent = findMonthExtent(data);
      console.log(psgr_mon_Extent);
  
      const colorScale = d3.scaleLinear()
        .domain(psgr_mon_Extent)
        .range(["white", color]);
  
      svgCalendar.selectAll("rect")
        .data(data)
        .enter()
        .append("g")
        .attr("transform", d => `translate(${yearScale(+d.year) + margin.left}, ${margin.top})`)
        .selectAll("rect")
        .data(d => months.map(month => ({ year: d.year, month: month, value: +d.months[month] })))
        .enter()
        .append("rect")
        .attr("x", 0)
        .attr("y", d => monthScale(d.month))
        .attr("width", monthScale.bandwidth())
        .attr("height", monthScale.bandwidth())
        .attr("fill", d => colorScale(d.value))
        .on("mouseover", show_interactive)
        .on("mouseout", function (event, d) {
          d3.select("#tooltip").remove();
          d3.select("#insights").remove();
          // d3.select("#select_border").remove();
        });
  
      svgCalendar.append("g")
        .selectAll("line")
        .data(years_cldr)
        .enter()
        .append("line")
        .attr("x1", d => yearScale(d) + margin.left)
        .attr("y1", margin.top)
        .attr("x2", d => yearScale(d) + margin.left)
        .attr("y2", innerHeight + margin.top)
        .attr("stroke", "#fff");
  
      svgCalendar.append("g")
        .selectAll("line")
        .data(months)
        .enter()
        .append("line")
        .attr("x1", margin.left)
        .attr("y1", d => monthScale(d) + margin.top)
        .attr("x2", innerWidth + margin.left)
        .attr("y2", d => monthScale(d) + margin.top)
        .attr("stroke", "#fff");
  
      svgCalendar.append("g")
        .selectAll("text")
        .data(years_cldr)
        .enter()
        .append("text")
        .text(d => d)
        .attr("x", d => yearScale(d) + margin.left + yearScale.bandwidth() / 2)
        .attr("y", margin.top / 2)
        .attr("text-anchor", "middle")
        .attr("alignment-baseline", "middle")
        .style("font-size", "10px");
  
      svgCalendar.append("g")
        .selectAll("text")
        .data(months)
        .enter()
        .append("text")
        .text(d => {
          const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
          return monthNames[d];
        })
        .attr("x", margin.left / 2)
        .attr("y", d => monthScale(d) + margin.top + monthScale.bandwidth() / 2)
        .style("font-size", "10px");
  
      const rectBorder = svgCalendar.append("rect")
        .attr("id", "select_border")
        .attr("x", yearScale(year_start) + margin.left)
        .attr("y", monthScale(month_start - 1) + margin.top)
        .attr("width", yearScale.bandwidth() * (2009 - 2006 + 1))
        .attr("height", monthScale(7) - monthScale(4))
        .attr("fill", "none")
        .style("stroke", "black")
        .attr("stroke-width", 2)
        .attr("pointer-events", "none");
  
      document.getElementById('calendarSelector').addEventListener('change', function () {
        const selectedDivId = this.value;
        const divContainers = document.getElementById('cityCalendar').querySelectorAll('div');
  
  
        divContainers.forEach(divContainer => {
          if (divContainer.id === selectedDivId) {
            divContainer.style.display = 'block';
          } else {
            divContainer.style.display = 'none';
          }
        });
      });
  
      function show_interactive(event, d) {
  
        const xPosition = parseFloat(d3.select(this).attr("x")) + yearScale.bandwidth() / 2 + margin.left;
        const yPosition = innerHeight + margin.top + 15;
  
  
        if (d.month >= month_start - 1 && d.month <= month_end && d.year >= year_start && d.year <= year_end) {
          // console.log(d, "in");
  
  
          svgCalendar.append("text")
            .attr("id", "insights")
            .attr("x", width / 2)
            .attr("y", height - 10)
            .attr("text-anchor", "middle")
            .attr("font-family", "sans-serif")
            .attr("font-size", "14px")
            .attr("fill", "black")
            .text(thoughts);
        }
  
        svgCalendar.append("text")
          .attr("id", "tooltip")
          .attr("x", xPosition)
          .attr("y", yPosition)
          .attr("text-anchor", "middle")
          .attr("font-family", "sans-serif")
          .attr("font-size", "12px")
          .attr("fill", "black")
          .text(d.value);
  
      }
    }
  
  
    function findMonthExtent(data) {
      let minPassenger = Infinity;
      let maxPassenger = -Infinity;
  
      data.forEach(yearData => {
  
        yearData.months.forEach(passengers => {
  
          if (passengers < minPassenger) {
            minPassenger = passengers;
          }
          if (passengers > maxPassenger) {
            maxPassenger = passengers;
          }
        });
      });
  
      return [minPassenger, maxPassenger];
    }
  
  </script>
</body>




</html>